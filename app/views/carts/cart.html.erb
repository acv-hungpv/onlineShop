<%= render 'shared/page_title', title: "list all products in cart" %>
<div align = "center" >
  <%= form_tag( "/payments", method: :post) do %>
    <table>
      <% if current_user.present? && is_item_to_show_content_in_cart? %>
        <tr>
          <td> IMG</td>
          <td>Product name</td>
          <td>Price </td>
          <td>Amounts</td>
          <td>Total prices</td>
          <td>Delete</td>
          <td>SelectPayment
            <%= form_for :cart, url: {:action => 'changecart', :controller => 'carts'} do |f| %>
            <% end %>
          </td>
        </tr>
        <% current_user.items.each do |item| %>
          <% if !item.ispayment %>
            <tr>
              <td> <%= image_tag item.product.image , size: 100 %></td>
              <td><%= item.product.name.capitalize %></td>
              <td><%= (item.product.price).round(2) %> <%= item.product.currency %></td>
              <td>
                <%= form_for :cart, url: {:action => 'changecart', :controller => 'carts'} do |f| %>
                  <%= f.number_field :amounts,
                    :value => item.amounts,
                     min: 1 %>
                  <%= f.hidden_field :product_id, :value => item.product.id %>
                  <%= f.submit  "change"%>

                <% end %>
              </td>
              <td><%= multiplication(item.product.price,item.amounts) %></td>
              <td><%= link_to "Delete this item", deletecart_path(item.id), method: :delete, data: { confirm: "are you sure delete this item"}, class: "btn btn-xs btn-danger", class: "btn btn-xs btn-warning" %></td>
              <td>
                <%= check_box_tag 'item_ids[]', item.id -%>
              </td>
            </tr>
          <% end %>
      <% end %>
      <% elsif !session[:cart].blank? %>
        <tr>
          <td> IMG</td>
          <td>Product name</td>
          <td>Price </td>
          <td>Amounts</td>
          <td>Total prices</td>
          <td>Delete</td>
        </tr> 
        <% session[:cart].each do |product_id, amounts|%>
          <% product = find_product(product_id) %>
            <tr>
              <td> <%= image_tag product.image , size: 100 %></td>
              <td><%= product.name.capitalize %></td>
              <td><%= (product.price).round(2) %> <%= product.currency %></td>
              <td>
                <%= form_for :cart, url: {:action => 'changecart', :controller => 'carts'} do |f| %>
                  <%= f.number_field :amounts,
                    :value => amounts,
                     min: 1 %>
                  <%= f.hidden_field :product_id, :value => product_id %>
                  <%= f.submit "change"%>

                <% end %>
              </td>
              <td><%= multiplication(product.price,amounts.to_i) %></td>
              <td><%= link_to "Delete this item", deletecart_path(product_id), method: :delete, data: { confirm: "are you sure delete this item"}, class: "btn btn-xs btn-danger", class: "btn btn-xs btn-warning" %></td>
            </tr>
        <% end %>
      <% else %>
        <p>Did not have products in cart </p>
      <% end %>
    </table>
    <% if current_user.present? && is_item_to_show_content_in_cart? %>
      <input class="btn btn-success btn-block btn-lg" type="submit" value="Payment">
    <% end %>
  <% end %>
</div>